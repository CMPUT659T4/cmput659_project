\documentclass{article} % For LaTeX2e
\usepackage{nips15submit_e,times}
\usepackage{hyperref}
\usepackage{url}
\usepackage{verbatim}
\usepackage{amsmath}
\usepackage{graphicx}


\title{Using fMRI to Diagnose Schizophrenia}
\author{%add name 
	\\
	Department of Computing Science\\
	University of Alberta\\
	\texttt{} 
\And 
 \\
Department of Computing Science\\
University of Alberta\\
\texttt{}
\And 
\\
Department of Computing Science\\
University of Alberta\\
\texttt{}  
}
\newcommand{\fix}{\marginpar{FIX}}
\newcommand{\new}{\marginpar{NEW}}

\nipsfinalcopy 

\begin{document}

	\maketitle

\begin{abstract}
Diagnosis of schizophrenia is a challenging task for which diagnostic tests
have yet to be developed~\cite{McGuire200891}. Although Functional Magnetic 
Resonance Imaging (fMRI) methods have become more common in the diagnosis of 
mental disorders have become more popular, for schizophrenia diagnosis fMRI 
methods need to be more robust and reliable. Similar 
studies~\cite{Rish_2013}\cite{Rosa_2013} have shown that fMRI can be used in 
conjunction with Sparse Gaussian Markov Random Field (SGMRF) to produce high 
accuracy in diagnosis of illness.
However having a dataset with homogeneous distribution of illness makes this 
result less reliable and creates the need for more evidence using 
heterogeneous dataset in terms of illness. 
In this work we pursue two paths to tackle this problem. First, we evaluate 
performance of Sparse Gaussian Markov Random Field (SGMRF) on fMRI data 
brain scans, and second we study on Regions of Interest (ROI) as defined by
Power \emph{et al.}~\cite{Power_2011}. 
We used 5 fold cross validation for hyper parameter tuning and $20\%$ holdout 
set for test. Accuracies that We have obtained the following accuracies using 
this method: —— for whole brain features and —- for ROI features. While these 
result are slightly less than the results obtained by Rish \emph{et al.}, 
they are on par with Rosa \emph{et al.} results.  
\end{abstract}


\section{Introduction}
Schizophrenia is a mental/psychiatric disorder~\cite{Rish_2013, Kenji_2010} 
known affect blood flow in the brain~\cite{Kenji_2010} where those who are 
affected can experience hallucinations, delusions and diminished mental 
capacities to varying extents~\cite{jablensky2010diagnostic}. While several
features of schizophrenia have proven useful for its diagnosis there are
current no set of features that have sufficient sensitivity or specificity
to be used in diagnostic tests~\cite{jablensky2010diagnostic}. This 
effectively means that subjectivity plays a role when a physician is 
diagnosing a patient. 

Functional Magnetic Resonance Imaging (fMRI) is a tool for recording 
functional changes caused by neuron activity\cite{}. When a person is doing a 
task, neuron activity fluctuates and in order to provide the energy 
needed for this activity, the blood flow increases to feed the neurons with 
the needed glucose, which is not stored in the brain\cite{}. More blood flow also 
brings more oxygen through blood vessels. This change in the level of 
oxygenated blood known as oxyhemoglobin and deoxyhemoglobin (oxygenated or 
deoxygenated blood) changes the magnetic susceptibility of blood (BOLD signal) 
which is detectable through fMRI~\cite{}.

fMRI is one of the most used and efficient tools in the study of 
psychiatric disorders such as Schizophrenia\cite{}. An advantage of fMRI in
medical diagnosis is that it is non-invasive. This means that unlike some 
other imaging methods, no instruments or dyes are placed in the patient’s body
body, this method operates without using them\cite{}. 

One of the approaches that has been used for studying schizophrenia is 
Sparse Gaussian Markov Random Field(SGMRF)~\cite{Rish_2013}\cite{Rosa_2013}. 
The primary advantage of using this method is that the functional network of 
the brain can be captured using the precision matrix~\cite{Rish_2013}.
By using the resulting network, healthy subjects can be differentiated from 
schizophrenic ones, by observing differences in the functional connectivity 
of the brain. Currently automated approaches to schizophrenia
diagnosis have been able to yeild accuracies of $93\%$ for data that 
originates from a single location~\cite{Rish_2013} and up to approximately 
$80\%$ for data that originates from multiple locations~\cite{Cheng2015}.

In this work we consider

The rest of the paper is organized as follows.


\section{Background and Prior Work}

\subsection{Regions of Interest and Single-Voxel Analysis}
Traditionally in fMRI analysis there are two main approaches for extracting
information from the fMRI image. The first is a single-voxel approach and 
the second is to study regions of interest (ROI)~\cite{heller2006cluster}. 
The tradeoff between these two approaches is that a single-voxel approach
requires the analysis of every voxel and is subject to the low signal to 
noise ratios of individual voxels, whereas a region based approach is only
as effective as the regions are relevant to the fMRI 
task~\cite{heller2006cluster}. In 2011, Power \emph{et al.} identified 264 
putative function regions of interest derived from resting state fMRI, where 
no specific task being performed during data collection~\cite{Power_2011}. 
These regions contain substructures that agree that with known functional 
brain systems and therefore can be seen as fairly accurate 
representations~\cite{Power_2011}.

\subsubsection{Calculating Degrees}
% Double check with Rish paper, this needs work.
When analyzing fMRI data features such as voxel degrees can be extracted for
use with a machine learner. Voxel degrees represent the connectedness of
voxels in the brain with the other voxels and are described as ``the number
of voxel neighbours in a network''~\cite{Rish_2013}. Degrees are calculated 
by performing
multiple Pearson correlation comparisons between the $i^{th}$ voxel and every
other voxel. Once correlation values have be determined, a threshold is
applied to the correlation matrix. This results in binary matrix where 1 
represents a correlation value above the threshold and 0 represents a value 
below. Finally, for each voxel the number of 1 entries are summed (excluding 
the comparison against itself) and this becomes the degree of the voxel.

%\subsection{Fourier Transform}
%A Fourier transform allows for the translation of any signal from the time
%domain to the frequency domain. More specifically, it takes a signal and
%decomposes it into a series constituent $\sin$ and $\cos$ componets. When 
%taking the Fast Fourier Transform or FFT of real data the resulting peaks in 
%the frequency domain are conjugate symmetric~\cite{duhamel1990fast}, meaning 
%that methods that only require the real component of the data need only work 
%with half of the resulting component coefficients in the transform. These 
%Fourier coefficients can be used in place of the original signal as features
%provided to a machine learning classifier.

\subsection{Multi-site Comparisons}
% Mario please add info on Chang
Although, there were several prior work on the classification of schizophrenia patients using fMRI, most of them are based on data from a single site. Classification from multi-site data is inherently difficult due to the batch effects resulted from the use of different machines and environments. At the same time, multi-site analysis can easily be generalized for a new data set from a totally different source. Cheng et al. \cite{Cheng2015} analyzes a multi site data set which is obtained from five different sites with different machines. They used SVM for classify schizophrenia patients and healthy controls and obtained accuracies in the range of $73.53- 80.92\%$. In this research we will try to obtain results with similar accuracies, but using probabilistic graphical methods.
\subsection{Principal Component Analysis}

\subsection{Support Vector Machines}
In a 1995 paper by Vladimir Vapnik \emph{et al.} the concept of support 
Vector Machines (SVMs) was introduced  as a statistical tool for 
classification problems~\cite{shmilovici2005support}. In our work we
use the simplest SVM, a linear SVM, because it does not use non-linear
kernels and therefore has no hyperparameters that need to be tuned
with cross validation. Instead, a linear SVM learns the ``maximum-margin
hyperplane'' classifier which is a linear combination of the input 
features and partitions the data space into separate classes. The term 
``maximum-margin'' refers to the SVM's ability to find the maximal 
separation between classes and the hyperplane, therefore creating the 
largest ``margin''~\cite{shmilovici2005support}. We can be guaranteed of
the optimality of the result as the SVM problem is known to be 
convex~\cite{burges1998tutorial}. The simplest form of a linear SVM 
minimizes $\frac{1}{2}||w||^2$ subject to the constraint 
$y_i (x_i w + b) - 1 \ge 0 $, $\forall i$ where $w$ is the weight vector,
$x_i$ is the instance's features, $y_i$ is the instance label and $b$ is
the bias term of the model. Unfortunately, this version of the SVM only
works in the case where the data is linearly separable. To extend the SVM
to linearly inseparable data, the addition of positive slack variables is
required such that the constraints become $\forall i$ 
$y_i (x_i w + b) - 1 + \xi_i \ge 0 $ and $\xi_i \ge 0$, where $xi_i$ is 
the slack variable for the instance $i$~\cite{burges1998tutorial}.


\subsection{SGMRF}
What is a SGMRF and how does it work

One variation of Markov Random Field is Gaussian Random which is mostly being used for continuous space of variables and has well-defined mathematic properties that can be computed. Multivariate Gaussian density function over set of random variables X is defined as below: 
\begin{equation}\label{gaussian1}
p(X) = (2\pi)^{-n/2} |\Sigma|^{-1/2} \exp\left\{ -\frac{1}{2}(X - \mu)^t \Sigma^{-1} (X - \mu) \right\}.
\end{equation}
 
Where $ \mu $   is mean and $ \Sigma $ is the covariance matrix. We can set the $ \mu$ to zero and replace $\Sigma^{-1}$ with $C$ the equation \eqref{gaussian1} can be written as the following form.
\begin{equation}\label{gaussian2}
p(X) = (2\pi)^{-n/2} |C|^{1/2} \exp\left\{ -\frac{1}{2}(X - \mu)^t \Sigma^{-1} (X - \mu) \right\}.
\end{equation}
\section{Methodology}

\subsection{Data Set}
Data used for this study were downloaded from the Function BIRN Data Repository (http://fbirnbdr.birncommunity.org:8080/BDR/). The original data contained nine sites and $235$ subjects. However, during the preprocessing steps some of the subjects were removed and we had $95$ subjects and five sites. Data were preprocessed by Dr. Mina Gheiratmand by using FSL software (http://fsl.fmrib.ox.ac.uk/fsl/fslwiki/). Our data contained 46 schizophrenic subjects and 49 healthy subjects. Each subject had four runs so effectively our data set had $380$ subjects. Each run had $137$ time slices and each time slice had the signal amplitude of over $100,000$ voxels. The voxels were referred using the 3D coordinates and thus the dimensionality of a single run was $\mathcal R^{N_1\times N_2\times N_3 \times 137}$.

We removed $80\%$ of subjects from each site as our holdout set and used the remaining set as our training set. Furthermore, we made sure that the holdout set is also balanced, so that the ratio between the patients and healthy subjects is same in the holdout and training sets for each site. Also we made sure that all the runs from the same subject either belonged to the holdout set or to the training set. The training set is used for finding the hyper parameters of the system using five-hold cross validations. After finding the hyper parameters we used the full training set to train the system with the selected hyper parameter and obtained the accuracy on the hold out set. Furthermore, we repeated this procedure five times for different hold out sets to get an average accuracy. 

\subsection{SGMRF with log degrees of ranked voxels}
\begin{figure}\label{fig:voxel_rank}
\includegraphics[width=\textwidth]{Voxel_ranking.jpg}
\caption{Voxel ranking methods to select best voxels, method 2 ranks the voxels based on the absolute difference between the average degrees, method 3 ranks based on the difference between the patients average degreees and healthy average degrees and method 4 ranks based on the difference between the healthy and patients average differences.}
\end{figure}
First, we executed the approach proposed by Rish \emph{et al.}~\cite{Rish_2013} on our data set. In the data set we used we had degrees of each voxels as well as the smoothed log values of the voxels for each subject. Furthermore, as some voxels of some subjects had zero values for the BOLD signal, an universal mask was used to select the voxels which had a non-zero BOLD signal value through the whole data set. This resulted in a $28719$ voxels per each subject. However, using all the available voxels resulted in computation difficulties and thus selecting the best voxels to separate the healthy and schizophrenic subjects was very important. 

To select the best voxels out of the possible $28719$ voxels, we experimented multiple approaches. These include \begin{enumerate}
  \item Selecting the voxels based on the t-test.
  \item Selecting the voxels based on the absolute differences between the mean degrees of a voxel between schizophrenic and healthy subjects.
  \item Selecting the voxels based on the differences between the mean degrees of a voxel between schizophrenic and healthy subjects.
  \item Selecting the voxels based on the differences between the mean degrees of a voxel between healthy and schizophrenic subjects.
\end{enumerate}
The last three voxel ranking methods are explained in Fig. \ref{fig:voxel_rank}. Out of the above four approaches we obtained the highest accuracy on our cross validation set by the third approach. Also the number of voxels $k$ to be used in the SGMRF model was decided by running the experiment for different $k$ values and found the optimum value$20$ for our cross validation set. By using the selected voxels, we obtained the precision matrices for schizophrenic and healthy subjects. Similar to the value of $k$, the sparsity coefficient $\lambda$ was also obtained through a hyper parameter search on our cross validation set.

\subsection{Methods using Power \emph{et al.}'s ROIs}

\subsubsection{ROI with Patient Concatenation}

\subsubsection{ROI with Fouier Coefficients}

\subsubsection{Region Degrees and SVMs}

\subsubsection{Individual MRF Structure Classification}

\subsection{Your Approach? Farhad}
Describe your experiments

\section{Results}

\subsection{Your Approach? Mario}
With the Rish et al. code we obtained a $ 69\%$ cross validation accuracy on our cross validation sets and $75 \%$ accuracy on the hold-out set.

\subsection{Methods using Power \emph{et al.}'s ROIs}

\subsubsection{ROI with Patient Concatenation}

\subsubsection{ROI with Fouier Coefficients}

\subsubsection{Region Degrees and SVMs}

\subsubsection{Individual MRF Structure Classification}

\subsection{Your Approach? Farhad}
Report your results

\section{Conclusions}

\section{Acknowledgements}
We would like to thank Dr. Mina Gheiratmand for preprocessing the fMRI data and co-coaching our project. Also we used the feature extraction codes provided by Dr. Irina Rish.
\bibliographystyle{plain}
\bibliography{T4_Report}

	
\end{document}
